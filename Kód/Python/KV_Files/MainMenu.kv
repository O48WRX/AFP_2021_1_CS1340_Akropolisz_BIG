#:import Clock kivy.clock.Clock
#:import partial functools
#:import socket socket

<MainMenu>:
    BoxLayout:
        orientation:"vertical"
        padding:200
        spacing:20
        Label:
            font_size:40
            bold:True
            text:"Video Creator"
            pos_hint:{'center_x': .5, 'center_y': .5}
        Button:
            text:"Make a Collage"
            size:(100, 150)
            pos_hint:{'center_x': .5, 'center_y': .5}
            background_color: 0.2, 0.9, 0.4, 1
            on_press:
                root.manager.transition.direction = "left"
                root.manager.transition.duration = 1
                root.manager.current = "user_collage"
        Button:
            text:"Demo"
            size:(100, 150)
            pos_hint:{'center_x': .5, 'center_y': .5}
            background_color: 0.2, 0.9, 0.4, 1
            on_press:
                root.manager.transition.direction = "left"
                root.manager.transition.duration = 1
                root.manager.current = "demo"

        Button:
            text:"Help"
            size:(100, 150)
            pos_hint:{'center_x': .5, 'center_y': .5}
            background_color: 0.2, 0.9, 0.4, 1
            on_press:
                root.manager.transition.direction = "left"
                root.manager.transition.duration = 1
                root.manager.current = "help"
        Button:
            text:"Exit"
            size:(100, 150)
            pos_hint:{'center_x': .5, 'center_y': .5}
            background_color: 1, 0, 0, 1
            on_press: app.stop()
<CreateCollage>
    id: uc_coll
    FloatLayout:
        orientation:'vertical'
        Video:
            id: uc_vid1
            visible: False
            hasSource: False
            size_hint_x: 0.4 if self.visible and self.hasSource else 0
            size_hint_y: 0.5 if self.visible and self.hasSource else 0
            opacity: 1 if self.visible and self.hasSource else 0
            state: "stop"
            allow_stretch: True

            pos: (10, 350)
            options: {'eos': 'loop'}
        Button:
            id:uc_vid1_button
            pos:(100, 370)
            size_hint:(0.2, 0.05)
            text:"Első videó tallózás"
            on_press:
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "vid1_fileselect"
        Slider:
            id:uc_vid1_slider
            orientation:"horizontal"
            size_hint:0.2,0.1
            pos_hint:{"center_x":0.1,"center_y":0.55}
            step:0.1
            min:0
            max:10
            value:0
        Label:
            text:str(uc_vid1_slider.value)
            size_hint: 0.1, 0.1
            font_size: 30
            color:0.0, 0.0, 0.0
            pos_hint:{"center_x":0.3,"center_y":0.55}

        Video:
            id: uc_vid2
            visible: False
            hasSource: False
            size_hint_x: 0.4 if self.visible and self.hasSource else 0
            size_hint_y: 0.5 if self.visible else 0
            opacity: 1 if self.visible and self.hasSource else 0
            state: "stop"
            options: {'eos': 'loop'}
            allow_stretch: True
            pos: (450, 350)
        Button:
            id:uc_vid2_button
            size_hint:(0.2, 0.05)
            text:"Második videó tallózás"
            pos:(525, 370)
            on_press:
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "vid2_fileselect"
        Slider:
            id:uc_vid2_slider
            orientation:"horizontal"
            size_hint:0.2,0.1
            pos_hint:{"center_x":0.85,"center_y":0.55}
            step:0.1
            min:0
            max:10
            value:0
        Label:
            text:str(uc_vid2_slider.value)
            size_hint: 0.1, 0.1
            font_size: 30
            color:0.0, 0.0, 0.0
            pos_hint:{"center_x":0.65,"center_y":0.55}

        Video:
            id: uc_vid3
            visible: False
            hasSource: False
            size_hint_x: 0.4 if self.visible and self.hasSource else 0
            size_hint_y: 0.5 if self.visible and self.hasSource else 0
            opacity: 1 if self.visible and self.hasSource else 0
            state: "stop"
            allow_stretch: True
            pos: (10, 70)
            options: {'eos': 'loop'}
        Button:
            id:uc_vid3_button
            size_hint:(0.2, 0.05)
            text:"Harmadik videó tallózás"
            pos:(100, 90)
            on_press:
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "vid3_fileselect"
        Slider:
            id:uc_vid3_slider
            orientation:"horizontal"
            size_hint:0.2,0.1
            pos_hint:{"center_x":0.25,"center_y":0.05}
            step:0.1
            min:0
            max:10
            value:0
        Label:
            text:str(uc_vid3_slider.value)
            size_hint: 0.1, 0.1
            font_size: 30
            color:0.0, 0.0, 0.0
            pos_hint:{"center_x":0.4,"center_y":0.05}
        Video:
            id: uc_vid4
            visible: False
            hasSource: False
            size_hint_x: 0.4 if self.visible and self.hasSource else 0
            size_hint_y: 0.5 if self.visible and self.hasSource else 0
            opacity: 1 if self.visible and self.hasSource else 0
            state: "stop"
            allow_stretch: True
            pos: (450, 70)
            options: {'eos': 'loop'}
        Button:
            id:uc_vid4_button
            size_hint:(0.2, 0.05)
            text:"Negyedik videó tallózás"
            pos:(525, 90)
            on_press:
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "vid4_fileselect"
        Slider:
            id:uc_vid4_slider
            orientation:"horizontal"
            size_hint:0.2,0.1
            pos_hint:{"center_x":0.85,"center_y":0.05}
            step:0.1
            min:0
            max:10
            value:0
        Label:
            text:str(uc_vid4_slider.value)
            size_hint: 0.1, 0.1
            font_size: 30
            color:0.0, 0.0, 0.0
            pos_hint:{"center_x":0.65,"center_y":0.05}
        Button:
            text: "Play My Collage!"
            pos: (308, 313)
            size_hint_x: 0.2
            size_hint_y: 0.1
            background_color: 0.2, 0.9, 0.4, 1
            on_press:
                Clock.schedule_once(lambda dt: setattr(uc_vid1,'state','play'),uc_vid1_slider.value)
                Clock.schedule_once(lambda dt: setattr(uc_vid1,'visible',True),uc_vid1_slider.value)
                Clock.schedule_once(lambda dt: setattr(uc_vid2,'state','play'),uc_vid2_slider.value)
                Clock.schedule_once(lambda dt: setattr(uc_vid2,'visible',True),uc_vid2_slider.value)
                Clock.schedule_once(lambda dt: setattr(uc_vid3,'state','play'),uc_vid3_slider.value)
                Clock.schedule_once(lambda dt: setattr(uc_vid3,'visible',True),uc_vid3_slider.value)
                Clock.schedule_once(lambda dt: setattr(uc_vid4,'state','play'),uc_vid4_slider.value)
                Clock.schedule_once(lambda dt: setattr(uc_vid4,'visible',True),uc_vid4_slider.value)
            Button:
                text:"Back"
                pos_hint:{'x': 0, 'y': 0}
                size_hint:(0.1, 0.1)
                background_color: 1, 0, 0, 1
                on_press:
                    root.manager.transition.direction = "right"
                    root.manager.transition.duration = 1
                    root.manager.current = "main_menu"

<Demo>
    FloatLayout:
        size: (300, 300)

        Video:
            id: vid1
            visible: False
            size_hint_x: 0.4 if self.visible else 0
            size_hint_y: 0.5 if self.visible else 0
            opacity: 1 if self.visible else 0
            source: "wavetest.mp4"
            state: "stop"
            allow_stretch: True

            pos: (10, 300)
            options: {'eos': 'loop'}
        Slider:
            id:v1_slider
            orientation:"horizontal"
            size_hint:0.2,0.5
            pos_hint:{"center_x":0.1,"center_y":0.5}
            step:0.1
            min:0
            max:10
            value:0
        Label:
            text:str(v1_slider.value)
            size_hint: 0.1, 0.1
            font_size: 30
            color:0.0, 0.0, 0.0
            pos_hint:{"center_x":0.3,"center_y":0.5}

        Video:
            id: vid2
            visible: False
            size_hint_x: 0.4 if self.visible else 0
            size_hint_y: 0.5 if self.visible else 0
            opacity: 1 if self.visible else 0
            source: "wavetest.mp4"
            state: "stop"
            options: {'eos': 'loop'}
            allow_stretch: True
            pos: (450, 300)

        Slider:
            id:v2_slider
            orientation:"horizontal"
            size_hint:0.2,0.5
            pos_hint:{"center_x":0.85,"center_y":0.5}
            step:0.1
            min:0
            max:10
            value:0

        Label:
            text:str(v2_slider.value)
            size_hint: 0.1, 0.1
            font_size: 30
            color:0.0, 0.0, 0.0
            pos_hint:{"center_x":0.65,"center_y":0.5}



        Video:
            id: vid3
            visible: False
            size_hint_x: 0.4 if self.visible else 0
            size_hint_y: 0.5 if self.visible else 0
            opacity: 1 if self.visible else 0
            source: "wavetest.mp4"
            state: "stop"
            allow_stretch: True

            pos: (10, 20)
            options: {'eos': 'loop'}
        Slider:
            id:v3_slider
            orientation:"horizontal"
            size_hint:0.2,0.5
            pos_hint:{"center_x":0.1,"center_y":0.08}
            step:0.1
            min:0
            max:10
            value:0
        Label:
            text:str(v3_slider.value)
            size_hint: 0.1, 0.1
            font_size: 30
            color:0.0, 0.0, 0.0
            pos_hint:{"center_x":0.3,"center_y":0.08}



        Video:
            id: vid4
            visible: False
            size_hint_x: 0.4 if self.visible else 0
            size_hint_y: 0.5 if self.visible else 0
            opacity: 1 if self.visible else 0
            source: "wavetest.mp4"
            state: "stop"
            allow_stretch: True
            pos: (450, 20)
            options: {'eos': 'loop'}
        Slider:
            id:v4_slider
            orientation:"horizontal"
            size_hint:0.2,0.5
            pos_hint:{"center_x":0.85,"center_y":0.08}
            step:0.1
            min:0
            max:10
            value:0
        Label:
            text:str(v4_slider.value)
            size_hint: 0.1, 0.1
            font_size: 30
            color:0.0, 0.0, 0.0
            pos_hint:{"center_x":0.65,"center_y":0.08}




        Button:
            text: "Hey, this is the demo!"
            pos_hint:{'center_x': .5, 'center_y': .5}
            size_hint_x: 0.2
            size_hint_y: 0.1
            background_color: 0.2, 0.9, 0.4, 1

            on_press:
                setattr(vid1,'visible',True)
                setattr(vid2,'visible',True)
                setattr(vid3,'visible',True)
                setattr(vid4,'visible',True)
                Clock.schedule_once(lambda dt: setattr(vid1,'state','play'),v1_slider.value)
                Clock.schedule_once(lambda dt: setattr(vid2,'state','play'),v2_slider.value)
                Clock.schedule_once(lambda dt: setattr(vid3,'state','play'),v3_slider.value)
                Clock.schedule_once(lambda dt: setattr(vid4,'state','play'),v4_slider.value)

        Button:
            size_hint_x: 0.2
            size_hint_y: 0.1
            pos_hint:{'center_x': .5, 'center_y': .35}
            text:"Back"
            background_color: 1, 0, 0, 1
            on_press:
                setattr(vid1,'state','stop')
                setattr(vid2,'state','stop')
                setattr(vid3,'state','stop')
                setattr(vid4,'state','stop')
                setattr(vid1,'visible',False)
                setattr(vid2,'visible',False)
                setattr(vid3,'visible',False)
                setattr(vid4,'visible',False)
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "main_menu"
<Help>
    BoxLayout:
        orientation:"vertical"
        padding:200
        spacing:20
        Label:
            text:"Make a collage - Main part of the program, in this menu you can create your own collage from videos you choose\nDemo - Get an insight into the operation of the program with a built-in collage\nHelp - This screen, here you will get some help with the program\nExit - With this button, you can exit from the program"
            font_size:15
            color: 1.0, 1.0, 1.0
        Button:
            text:"Back"
            size:(100, 150)
            pos_hint:{'x': 0, 'y': 0}
            background_color: 1, 0, 0, 1
            on_press:
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "main_menu"
<SelectFile1>
    BoxLayout:
        id: vid1select
        FileChooserIconView:
            id:filechooser1
            on_selection:
                root.manager.get_screen('user_collage').ids.uc_vid1.source = filechooser1.selection[0]
                root.manager.get_screen('user_collage').ids.uc_vid1.hasSource = True
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "user_collage"
<SelectFile2>
    BoxLayout:
        id: vid2select
        FileChooserIconView:
            id:filechooser2
            on_selection:
                root.manager.get_screen('user_collage').ids.uc_vid2.source = filechooser2.selection[0]
                root.manager.get_screen('user_collage').ids.uc_vid2.hasSource = True
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "user_collage"
<SelectFile3>
    BoxLayout:
        id: vid3select
        FileChooserIconView:
            id:filechooser3
            on_selection:
                root.manager.get_screen('user_collage').ids.uc_vid3.source = filechooser3.selection[0]
                root.manager.get_screen('user_collage').ids.uc_vid3.hasSource = True
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "user_collage"
<SelectFile4>
    BoxLayout:
        id: vid4select
        FileChooserIconView:
            id:filechooser4
            on_selection:
                root.manager.get_screen('user_collage').ids.uc_vid4.source = filechooser4.selection[0]
                root.manager.get_screen('user_collage').ids.uc_vid4.hasSource = True
                root.manager.transition.direction = "right"
                root.manager.transition.duration = 1
                root.manager.current = "user_collage"

<MyCollage>
    Video:
        id: vid1
        size_hint_x: 0.4
        size_hint_y: 0.5
        #source: root.manager.data_path1
        state: "stop"
        allow_stretch: True

        pos: (10, 300)
        options: {'eos': 'loop'}
    Slider:
        id:v1_slider
        orientation:"horizontal"
        size_hint:0.2,0.5
        pos_hint:{"center_x":0.1,"center_y":0.5}
        step:0.1
        min:0
        max:10
        value:0
    Label:
        text:str(v1_slider.value)
        size_hint: 0.1, 0.1
        font_size: 30
        color:0.0, 0.0, 1.0
        pos_hint:{"center_x":0.3,"center_y":0.5}

    Video:
        id: vid2
        size_hint_x: 0.4
        size_hint_y: 0.5
        #source: root.manager.data_path2
        state: "stop"
        options: {'eos': 'loop'}
        allow_stretch: True
        pos: (450, 300)

    Slider:
        id:v2_slider
        orientation:"horizontal"
        size_hint:0.2,0.5
        pos_hint:{"center_x":0.85,"center_y":0.5}
        step:0.1
        min:0
        max:10
        value:0

    Label:
        text:str(v2_slider.value)
        size_hint: 0.1, 0.1
        font_size: 30
        color:0.0, 0.0, 0.0
        pos_hint:{"center_x":0.65,"center_y":0.5}



    Video:
        id: vid3
        size_hint_x: 0.4
        size_hint_y: 0.5
        #source: root.manager.data_path3
        state: "stop"
        allow_stretch: True

        pos: (10, 20)
        options: {'eos': 'loop'}
    Slider:
        id:v3_slider
        orientation:"horizontal"
        size_hint:0.2,0.5
        pos_hint:{"center_x":0.1,"center_y":0.08}
        step:0.1
        min:0
        max:10
        value:0
    Label:
        text:str(v3_slider.value)
        size_hint: 0.1, 0.1
        font_size: 30
        color:0.0, 0.0, 0.0
        pos_hint:{"center_x":0.3,"center_y":0.08}



    Video:
        id: vid4
        size_hint_x: 0.4
        size_hint_y: 0.5
        #source: root.manager.data_path4
        state: "stop"
        allow_stretch: True
        pos: (450, 20)
        options: {'eos': 'loop'}
    Slider:
        id:v4_slider
        orientation:"horizontal"
        size_hint:0.2,0.5
        pos_hint:{"center_x":0.85,"center_y":0.08}
        step:0.1
        min:0
        max:10
        value:0
    Label:
        text:str(v4_slider.value)
        size_hint: 0.1, 0.1
        font_size: 30
        color:0.0, 0.0, 0.0
        pos_hint:{"center_x":0.65,"center_y":0.08}
    Button:
        text: "Hey, this is the demo!"
        pos_hint:{'center_x': .5, 'center_y': .5}
        size_hint_x: 0.2
        size_hint_y: 0.1
        background_color: 0.2, 0.9, 0.4, 1

        on_press:
            Clock.schedule_once(lambda dt: setattr(vid1,'state','play'),v1_slider.value)
            Clock.schedule_once(lambda dt: setattr(vid2,'state','play'),v2_slider.value)
            Clock.schedule_once(lambda dt: setattr(vid3,'state','play'),v3_slider.value)
            Clock.schedule_once(lambda dt: setattr(vid4,'state','play'),v4_slider.value)

    Button:
        size_hint_x: 0.2
        size_hint_y: 0.1
        pos_hint:{'center_x': .5, 'center_y': .35}
        text:"Back"
        background_color: 1, 0, 0, 1
        on_press:
            setattr(vid1,'state','stop')
            setattr(vid2,'state','stop')
            setattr(vid3,'state','stop')
            setattr(vid4,'state','stop')
            root.manager.transition.direction = "left"
            root.manager.transition.duration = 1
            root.manager.current = "user_collage"
